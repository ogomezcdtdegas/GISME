{% extends 'base.html' %}
{% load static %}

{% block title %}Monitoreo Coriolis{% if sistema %} - {{ sistema.tag }} {{ sistema.sistema_id }}{% endif %} - GISME{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/monitoreo.css' %}">
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
<style>
    .custom-marker {
        background: transparent;
        border: none;
    }
    
    .leaflet-popup-content {
        margin: 8px 12px;
        font-size: 14px;
    }
    
    .leaflet-popup-content h6 {
        color: #0d6efd;
        margin-bottom: 8px;
    }
    
    .chart-container {
        position: relative;
        height: 400px;
        width: 100%;
    }
    
    .metrics-container {
        background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    .metric-item:last-child {
        border-bottom: none;
    }
    
    .metric-value {
        font-weight: bold;
        font-size: 1.1em;
    }
    
    .trend-up {
        color: #28a745;
    }
    
    .trend-down {
        color: #dc3545;
    }
    
    .trend-stable {
        color: #6c757d;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    {% if show_selector %}
        <!-- ============ VISTA DE SELECCIÓN DE SISTEMAS ============ -->
        <div id="sistema-selector-view">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="bi bi-diagram-3"></i> Monitoreo Coriolis
                            </h4>
                            <p class="mb-0 mt-2">Seleccione el sistema que desea monitorear</p>
                        </div>
                        <div class="card-body">
                            <!-- Barra de búsqueda -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                                        <input type="text" class="form-control" id="searchInput" placeholder="Buscar sistemas...">
                                    </div>
                                </div>
                                <div class="col-md-6 text-end">
                                    <button class="btn btn-outline-secondary" id="clearSearch">
                                        <i class="bi bi-x-circle"></i> Limpiar
                                    </button>
                                </div>
                            </div>

                            <!-- Tabla de sistemas -->
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th scope="col">
                                                <span style="cursor: pointer;" onclick="sortTable('tag')">
                                                    Tag <i class="bi bi-arrow-up-down ms-1" id="tag-sort-icon"></i>
                                                </span>
                                            </th>
                                            <th scope="col">
                                                <span style="cursor: pointer;" onclick="sortTable('sistema_id')">
                                                    ID Sistema <i class="bi bi-arrow-up-down ms-1" id="sistema_id-sort-icon"></i>
                                                </span>
                                            </th>
                                            <th scope="col">
                                                <span style="cursor: pointer;" onclick="sortTable('ubicacion_nombre')">
                                                    Ubicación <i class="bi bi-arrow-up-down ms-1" id="ubicacion_nombre-sort-icon"></i>
                                                </span>
                                            </th>
                                            <th scope="col">Coordenadas</th>
                                            <th scope="col">Acción</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sistemasTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center">
                                                <div class="spinner-border spinner-border-sm" role="status">
                                                    <span class="visually-hidden">Cargando...</span>
                                                </div>
                                                Cargando sistemas...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Paginación -->
                            <div id="pagination" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <!-- ============ VISTA DE MONITOREO DE SISTEMA ESPECÍFICO ============ -->
        <div id="sistema-monitoring-view">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="{% url 'monitoreo_coriolis' %}">Monitoreo Coriolis</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                {{ sistema.tag }} {{ sistema.sistema_id }}
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">
                                <i class="bi bi-diagram-3"></i> Monitoreo de Medidores Coriolis "{{ sistema.tag }} {{ sistema.sistema_id }}"
                            </h4>
                            <a href="{% url 'monitoreo_coriolis' %}" class="btn btn-light btn-sm">
                                <i class="bi bi-arrow-left"></i> Cambiar Sistema
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Panel de Estado -->
                                <div class="col-lg-8 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">
                                                <i class="bi bi-activity"></i> Estado del Sistema
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-4 text-center">
                                                    <div class="card bg-success text-white">
                                                        <div class="card-body">
                                                            <i class="bi bi-check-circle" style="font-size: 2rem;"></i>
                                                            <h6 class="mt-2">Sistema Activo</h6>
                                                            <p class="mb-0">Funcionando correctamente</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-center">
                                                    <div class="card bg-info text-white">
                                                        <div class="card-body">
                                                            <i class="bi bi-droplet" style="font-size: 2rem;"></i>
                                                            <h6 class="mt-2">Flujo Actual</h6>
                                                            <p class="mb-0">125.4 m³/h</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-center">
                                                    <div class="card bg-warning text-white">
                                                        <div class="card-body">
                                                            <i class="bi bi-thermometer-half" style="font-size: 2rem;"></i>
                                                            <h6 class="mt-2">Temperatura</h6>
                                                            <p class="mb-0">24.5°C</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Panel de Controles -->
                                <div class="col-lg-4 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">
                                                <i class="bi bi-gear"></i> Controles
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary">
                                                    <i class="bi bi-play-circle"></i> Iniciar Monitoreo
                                                </button>
                                                <button class="btn btn-warning">
                                                    <i class="bi bi-pause-circle"></i> Pausar
                                                </button>
                                                <button class="btn btn-info">
                                                    <i class="bi bi-download"></i> Exportar Datos
                                                </button>
                                                <button class="btn btn-secondary">
                                                    <i class="bi bi-gear"></i> Configuración
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gráfico de Tendencias -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">
                                                <i class="bi bi-graph-up"></i> Tendencias en Tiempo Real
                                            </h5>
                                            <div class="d-flex align-items-center">
                                                <span class="badge bg-success me-2">
                                                    <i class="bi bi-broadcast-pin"></i> En Vivo
                                                </span>
                                                <small class="text-muted">Actualización cada 2s</small>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <!-- Métricas Instantáneas -->
                                            <div class="metrics-container">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="metric-item">
                                                            <span>Presión (PSI):</span>
                                                            <span class="metric-value trend-up" id="current-pressure">125.4</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="metric-item">
                                                            <span>Flujo (m³/h):</span>
                                                            <span class="metric-value trend-stable" id="current-flow">87.2</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="metric-item">
                                                            <span>Temperatura (°C):</span>
                                                            <span class="metric-value trend-down" id="current-temp">24.8</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="metric-item">
                                                            <span>Densidad (kg/m³):</span>
                                                            <span class="metric-value trend-up" id="current-density">0.823</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Gráfico -->
                                            <div class="chart-container">
                                                <canvas id="trendChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Información del Sistema -->
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="bi bi-info-circle"></i> Información del Sistema
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-sm">
                                                <tr>
                                                    <td><strong>Tag:</strong></td>
                                                    <td>{{ sistema.tag }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>ID Sistema:</strong></td>
                                                    <td>{{ sistema.sistema_id }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Ubicación:</strong></td>
                                                    <td>{{ sistema.ubicacion.nombre }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Coordenadas:</strong></td>
                                                    <td>
                                                        <a href="#" onclick="showMapModal('{{ sistema.ubicacion.latitud }}', '{{ sistema.ubicacion.longitud }}', '{{ sistema.tag }}', '{{ sistema.sistema_id }}', '{{ sistema.ubicacion.nombre }}')" 
                                                           class="text-primary text-decoration-none" 
                                                           title="Ver en mapa">
                                                            <i class="bi bi-geo-alt me-1"></i>{{ sistema.ubicacion.latitud }}, {{ sistema.ubicacion.longitud }}
                                                        </a>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="bi bi-clock"></i> Estado de Conexión
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex align-items-center">
                                                <span class="badge bg-success me-2">Conectado</span>
                                                <small class="text-muted">Última actualización: hace 2 segundos</small>
                                            </div>
                                            <div class="mt-3">
                                                <small class="text-muted">Próxima actualización en: <span id="countdown">2</span>s</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<!-- Modal para el mapa de ubicación -->
<div class="modal fade" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mapModalLabel">
                    <i class="bi bi-geo-alt"></i> Ubicación del Sistema
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="map" style="height: 400px;">
                    <!-- El mapa se carga aquí dinámicamente -->
                </div>
                <div class="mt-3">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Sistema:</strong> <span id="modal-sistema-info"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Ubicación:</strong> <span id="modal-ubicacion-info"></span>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <strong>Coordenadas:</strong> <span id="modal-coordenadas-info"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="copyCoordinates()">
                    <i class="bi bi-clipboard"></i> Copiar Coordenadas
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% if show_selector %}
    <script type="module" src="{% static 'js/monitoreo/sistema-selector.js' %}"></script>
{% else %}
    <script>
        // JavaScript específico para el monitoreo del sistema
        console.log('Monitoreo del sistema {{ sistema.tag }} {{ sistema.sistema_id }} iniciado');
        
        // Variables globales para la gráfica
        let trendChart;
        let chartData = {
            labels: [],
            datasets: [
                {
                    label: 'Presión (PSI)',
                    data: [],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Flujo (m³/h)',
                    data: [],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Temperatura (°C)',
                    data: [],
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Densidad (kg/m³)',
                    data: [],
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'y1'
                }
            ]
        };

        // Valores base para simulación
        let baseValues = {
            pressure: 125,
            flow: 87,
            temperature: 25,
            density: 0.82
        };

        // Inicializar gráfica
        function initChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;

            trendChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sistema {{ sistema.tag }} {{ sistema.sistema_id }} - Tendencias en Tiempo Real',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#007bff',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Tiempo'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Presión / Flujo / Temperatura'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Densidad (kg/m³)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });

            // Llenar datos iniciales
            const now = new Date();
            for (let i = 19; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 2000);
                addDataPoint(time);
            }
        }

        // Agregar punto de datos
        function addDataPoint(time) {
            const timeStr = time.toLocaleTimeString();
            
            // Simular variaciones realistas
            const pressure = baseValues.pressure + (Math.random() - 0.5) * 10;
            const flow = Math.max(0, baseValues.flow + (Math.random() - 0.5) * 15);
            const temperature = baseValues.temperature + (Math.random() - 0.5) * 3;
            const density = Math.max(0, baseValues.density + (Math.random() - 0.5) * 0.05);

            // Actualizar valores base con tendencia ligera
            baseValues.pressure += (Math.random() - 0.5) * 0.5;
            baseValues.flow += (Math.random() - 0.5) * 0.3;
            baseValues.temperature += (Math.random() - 0.5) * 0.1;
            baseValues.density += (Math.random() - 0.5) * 0.001;

            // Mantener rangos realistas
            baseValues.pressure = Math.max(100, Math.min(150, baseValues.pressure));
            baseValues.flow = Math.max(60, Math.min(120, baseValues.flow));
            baseValues.temperature = Math.max(20, Math.min(35, baseValues.temperature));
            baseValues.density = Math.max(0.7, Math.min(0.9, baseValues.density));

            // Agregar datos al gráfico
            chartData.labels.push(timeStr);
            chartData.datasets[0].data.push(pressure.toFixed(1));
            chartData.datasets[1].data.push(flow.toFixed(1));
            chartData.datasets[2].data.push(temperature.toFixed(1));
            chartData.datasets[3].data.push(density.toFixed(3));

            // Mantener solo los últimos 20 puntos
            if (chartData.labels.length > 20) {
                chartData.labels.shift();
                chartData.datasets.forEach(dataset => dataset.data.shift());
            }

            // Actualizar gráfico
            if (trendChart) {
                trendChart.update('none');
            }

            // Actualizar valores en tiempo real en la interfaz
            updateMetrics(pressure, flow, temperature, density);
        }

        // Actualizar métricas en la interfaz
        function updateMetrics(pressure, flow, temperature, density) {
            const elements = {
                'current-pressure': pressure.toFixed(1),
                'current-flow': flow.toFixed(1),
                'current-temp': temperature.toFixed(1),
                'current-density': density.toFixed(3)
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    const oldValue = parseFloat(element.textContent);
                    const newValue = parseFloat(value);
                    
                    element.textContent = value;
                    
                    // Aplicar clase de tendencia
                    element.className = element.className.replace(/trend-\w+/g, '');
                    if (newValue > oldValue) {
                        element.classList.add('metric-value', 'trend-up');
                    } else if (newValue < oldValue) {
                        element.classList.add('metric-value', 'trend-down');
                    } else {
                        element.classList.add('metric-value', 'trend-stable');
                    }
                }
            });
        }

        // Inicializar cuando el documento esté listo
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
        });

        // Actualizar datos cada 2 segundos
        setInterval(() => {
            addDataPoint(new Date());
        }, 2000);

        // Countdown para próxima actualización (ahora cada 2 segundos)
        let countdown = 2;
        setInterval(() => {
            const countdownElement = document.getElementById('countdown');
            if (countdownElement) {
                countdown--;
                if (countdown <= 0) countdown = 2;
                countdownElement.textContent = countdown;
            }
        }, 1000);
    </script>
{% endif %}

<!-- Chart.js para gráficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script>
// Funciones globales para el modal del mapa
let map;
let marker;

function showMapModal(lat, lng, sistemaTag, sistemaId, ubicacionNombre) {
    // Actualizar información del modal
    document.getElementById('modal-sistema-info').textContent = `${sistemaTag} ${sistemaId}`;
    document.getElementById('modal-ubicacion-info').textContent = ubicacionNombre;
    document.getElementById('modal-coordenadas-info').textContent = `${lat}, ${lng}`;
    
    // Mostrar el modal
    const mapModal = new bootstrap.Modal(document.getElementById('mapModal'));
    mapModal.show();
    
    // Esperar a que el modal se muestre para inicializar el mapa
    document.getElementById('mapModal').addEventListener('shown.bs.modal', function initMap() {
        // Solo inicializar una vez
        this.removeEventListener('shown.bs.modal', initMap);
        
        // Limpiar mapa anterior si existe
        if (map) {
            map.remove();
        }
        
        // Verificar que Leaflet esté disponible
        if (typeof L === 'undefined') {
            console.error('Leaflet no está disponible. Asegúrate de incluir la librería Leaflet.');
            document.getElementById('map').innerHTML = '<div class="alert alert-warning">Error: No se pudo cargar el mapa. Falta la librería Leaflet.</div>';
            return;
        }
        
        try {
            // Crear el mapa
            map = L.map('map').setView([parseFloat(lat), parseFloat(lng)], 15);
            
            // Agregar tiles de OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            // Crear icono personalizado para el sistema
            const sistemaIcon = L.divIcon({
                html: '<i class="bi bi-gear-fill text-primary" style="font-size: 24px;"></i>',
                iconSize: [30, 30],
                className: 'custom-marker'
            });
            
            // Agregar marcador
            marker = L.marker([parseFloat(lat), parseFloat(lng)], { icon: sistemaIcon })
                .addTo(map)
                .bindPopup(`
                    <div class="text-center">
                        <h6><i class="bi bi-gear"></i> ${sistemaTag} ${sistemaId}</h6>
                        <p class="mb-1"><strong>Ubicación:</strong> ${ubicacionNombre}</p>
                        <p class="mb-0"><strong>Coordenadas:</strong><br>${lat}, ${lng}</p>
                    </div>
                `)
                .openPopup();
                
        } catch (error) {
            console.error('Error inicializando el mapa:', error);
            document.getElementById('map').innerHTML = '<div class="alert alert-danger">Error al cargar el mapa.</div>';
        }
    });
}

function copyCoordinates() {
    const coordenadas = document.getElementById('modal-coordenadas-info').textContent;
    
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(coordenadas).then(() => {
            // Mostrar mensaje de éxito
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="bi bi-check"></i> Copiado!';
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-success');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-primary');
            }, 2000);
        });
    } else {
        // Fallback para navegadores sin soporte de clipboard API
        const textArea = document.createElement('textarea');
        textArea.value = coordenadas;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        // Mostrar mensaje de éxito
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check"></i> Copiado!';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-success');
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-primary');
        }, 2000);
    }
}
</script>
{% endblock %}
