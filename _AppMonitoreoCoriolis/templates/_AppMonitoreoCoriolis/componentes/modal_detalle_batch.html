{% load static %}
<!-- CSS para el modal de detalle batch -->
<link rel="stylesheet" href="{% static '_AppMonitoreoCoriolis/css/css_detalle_batch/modal_detalle_batch.css' %}">

<!-- Modal para mostrar el detalle de un batch específico -->
<div class="modal fade" id="modalDetalleBatch" tabindex="-1" aria-labelledby="modalDetalleBatchLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalDetalleBatchLabel">
                    <i class="bi bi-graph-up"></i> Detalle del Batch Detectado
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <!-- Información básica del batch -->
                <div class="row g-3" id="contenedorBatch">
                    <div class="col-md-4 mb-3">
                        <div class="card card-pastel h-100 shadow-sm">
                            <div class="card-header card-header-pastel">
                                Información Básica
                            </div>
                            <div class="card-body" id="infoBatchBasica"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-8 mb-3">
                        <div class="card card-pastel h-100 shadow-sm">
                            <div class="card-header card-header-pastel">
                                Estadísticas del Batch
                            </div>
                            <div class="card-body" id="estadisticasBatch"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Gráfico del batch -->
                <div class="card card-pastel mb-3 shadow-sm">
                    <div class="card-header card-header-pastel">
                        <i class="bi bi-graph-up"></i> Gráfico del Batch
                    </div>
                    <div class="card-body">
                        <div class="chart-container mb-3" style="position: relative; height: 400px;">
                            <canvas id="batchChart"></canvas>
                        </div>
                        <div class="chart-controls border rounded-3 p-3 bg-white">
                            <h6 class="fw-semibold mb-3 text-center">
                                <i class="bi bi-sliders"></i> Controles del gráfico
                            </h6>
                            <div class="d-flex flex-wrap justify-content-center gap-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showMassRate" checked>
                                    <label class="form-check-label" for="showMassRate">
                                        Flujo Másico (kg/min)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showTotalMass" checked>
                                    <label class="form-check-label" for="showTotalMass">
                                        Masa Total (kg)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showTemperature">
                                    <label class="form-check-label" for="showTemperature">
                                        Temperatura (°F)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showPressure">
                                    <label class="form-check-label" for="showPressure">
                                        Presión (psi)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showDensity">
                                    <label class="form-check-label" for="showDensity">
                                        Densidad (g/cc)
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3 mb-0 small">
                            <div class="row g-3 align-items-center">
                                <div class="col-lg-4">
                                    <strong><i class="bi bi-info-circle me-1"></i> Contexto extendido:</strong><br>
                                    La gráfica incluye 3 minutos antes y después del batch para un análisis más completo.
                                </div>
                                <div class="col-lg-8">
                                    <p class="mb-1">
                                        <i class="bi bi-circle-fill me-1" style="color: #5dade2;"></i>
                                        <strong>Línea azul clara:</strong> Datos del batch detectado (línea gruesa, puntos grandes)
                                    </p>
                                    <p class="mb-1">
                                        <i class="bi bi-circle-fill me-1" style="color: #1f618d;"></i>
                                        <strong>Línea azul oscura:</strong> Contexto previo/posterior (línea fina, puntos pequeños)
                                    </p>
                                    <p class="mb-0">
                                        <i class="bi bi-dash-lg me-1" style="color: #c0392b;"></i>
                                        <strong>Líneas rojas:</strong> Límites configurados de flujo másico
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Incertidumbre -->
                <div class="card card-pastel mb-3 shadow-sm">
                    <div class="card-header card-header-pastel">
                        <i class="bi bi-percent"></i> Incertidumbre de volumen @60°F
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <table class="table table-sm align-middle mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Componente</th>
                                                <th>Unidad</th>
                                                <th class="text-end">Valor</th>
                                                <th class="text-end">U std comb</th>
                                                <th class="text-end">Contrib bbl</th>
                                                <th class="text-end">Contrib %</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="fw-semibold">Masa Coriolis</td>
                                                <td>kg</td>
                                                <td class="text-end">
                                                    <span id="valorMasa" class="fw-semibold text-primary">-</span>
                                                </td>
                                                <td>
                                                    <input type="number" class="form-control form-control-sm text-end" id="uMF" name="uMF" readonly placeholder="-">
                                                </td>
                                                <td>
                                                    <div class="input-group input-group-sm">
                                                        <input type="number" class="form-control text-end" id="cMF" name="cMF" readonly placeholder="-">
                                                        <span class="input-group-text">bbl</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="input-group input-group-sm">
                                                        <input type="number" class="form-control text-end" id="crMF" name="crMF" readonly placeholder="-">
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="fw-semibold">Densidad @60°F</td>
                                                <td>g/cc</td>
                                                <td class="text-end">
                                                    <span id="valorDensidad" class="fw-semibold text-primary">-</span>
                                                </td>
                                                <td>
                                                    <input type="number" class="form-control form-control-sm text-end" id="udl" name="udl" readonly placeholder="-">
                                                </td>
                                                <td>
                                                    <div class="input-group input-group-sm">
                                                        <input type="number" class="form-control text-end" id="cdl" name="cdl" readonly placeholder="-">
                                                        <span class="input-group-text">bbl</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="input-group input-group-sm">
                                                        <input type="number" class="form-control text-end" id="crdl" name="crdl" readonly placeholder="-">
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row justify-content-end">
                                    <div class="col-lg-6 col-xl-5 incertidumbre-resumen">
                                        <div class="table-responsive">
                                            <table class="table table-sm align-middle mb-0">
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <small>u combinada</small>
                                                                <span class="fw-semibold">uc</span>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <div class="input-group input-group-sm">
                                                                <input type="number" class="form-control" id="U" name="U" readonly placeholder="-">
                                                                <span class="input-group-text">bbl</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <small>U expandida</small>
                                                                <span class="fw-semibold">k·uc</span>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <div class="input-group input-group-sm">
                                                                <input type="number" class="form-control" id="Uexp" name="Uexp" readonly placeholder="-">
                                                                <span class="input-group-text">bbl</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <small>Volumen @60°F</small>
                                                                <span class="fw-semibold">Estándar Neto</span>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <div class="input-group input-group-sm">
                                                                <input type="number" class="form-control" id="NSV" name="NSV" readonly placeholder="-">
                                                                <span class="input-group-text">bbl</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <small>U relativa</small>
                                                                <span class="fw-semibold">Uexp / NSV</span>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <div class="input-group input-group-sm">
                                                                <input type="number" class="form-control" id="Urel" name="Urel" readonly placeholder="-">
                                                                <span class="input-group-text">%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <small>Masa corregida</small>
                                                                <span class="fw-semibold">Batch</span>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <div class="input-group input-group-sm">
                                                                <input type="number" class="form-control" id="masa" name="masa" readonly placeholder="-">
                                                                <span class="input-group-text">kg</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <small>Factor de cobertura</small>
                                                                <span class="fw-semibold">k</span>
                                                            </div>
                                                        </td>
                                                        <td class="text-end">
                                                            <input type="text" class="form-control form-control-sm text-end" id="k" name="k" readonly placeholder="-">
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diagnóstico del medidor -->
                <div class="card card-pastel mb-3 shadow-sm">
                    <div class="card-header card-header-pastel">
                        <i class="bi bi-activity"></i> Diagnóstico del Medidor Coriolis
                    </div>
                    <div class="card-body" id="diagnosticoBatch">
                        <div class="text-muted small">
                            <i class="bi bi-info-circle"></i> No hay diagnóstico disponible.
                        </div>
                    </div>
                </div>

                <!-- Gráfico técnico del batch -->
                <div class="card card-pastel mb-3 shadow-sm">
                    <div class="card-header card-header-pastel">
                        <i class="bi bi-gear"></i> Gráfico Técnico del Batch
                    </div>
                    <div class="card-body">
                        <div class="chart-container mb-3" style="position: relative; height: 400px;">
                            <canvas id="batchChartTecnico"></canvas>
                        </div>
                        <div class="chart-controls border rounded-3 p-3 bg-white">
                            <h6 class="fw-semibold mb-3 text-center">
                                <i class="bi bi-sliders"></i> Controles del gráfico técnico
                            </h6>
                            <div class="d-flex flex-wrap justify-content-center gap-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showFlowRate" checked>
                                    <label class="form-check-label" for="showFlowRate">
                                        Caudal Másico (kg/min)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showDensityTech" checked>
                                    <label class="form-check-label" for="showDensityTech">
                                        Densidad (g/cc)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showDriverCurrent">
                                    <label class="form-check-label" for="showDriverCurrent">
                                        Driver Current (mA)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showDriverAmplitude">
                                    <label class="form-check-label" for="showDriverAmplitude">
                                        Driver Amplitude
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showNoiseN1">
                                    <label class="form-check-label" for="showNoiseN1">
                                        Noise N1
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showNoiseN2">
                                    <label class="form-check-label" for="showNoiseN2">
                                        Noise N2
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="showFrequency">
                                    <label class="form-check-label" for="showFrequency">
                                        Frecuencia (Hz)
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3 mb-0 small">
                            <div class="row g-3 align-items-center">
                                <div class="col-lg-4">
                                    <strong><i class="bi bi-info-circle me-1"></i> Variables técnicas:</strong><br>
                                    Parámetros de diagnóstico y control del medidor Coriolis durante el batch.
                                </div>
                                <div class="col-lg-8">
                                    <p class="mb-1">
                                        <i class="bi bi-circle-fill me-1" style="color: #2ecc71;"></i>
                                        <strong>Línea verde:</strong> Datos del batch detectado (línea gruesa, puntos grandes)
                                    </p>
                                    <p class="mb-0">
                                        <i class="bi bi-circle-fill me-1" style="color: #27ae60;"></i>
                                        <strong>Línea verde oscura:</strong> Contexto previo/posterior (línea fina, puntos pequeños)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle"></i> Cerrar
        </button>
        
        <button type="button" id="btnAsignarTicket" class="btn btn-warning" onclick="asignarTicketBatch()">
            <i class="bi bi-tag"></i> Asignar Ticket
        </button>

        <button type="button" class="btn btn-primary" onclick="descargarDatosBatch()">
            <i class="bi bi-file-earmark-pdf"></i> Descargar PDF Ticket
        </button>
        </div>
    </div>
</div>
</div>

<!-- JavaScript para el modal de detalle batch -->
<script src="{% static '_AppMonitoreoCoriolis/js/js_modal_detalle_batch/modal_detalle_batch.js' %}"></script>